
<!DOCTYPE html>
<html>
<head>
    <title>GenAgents Chat</title>
    <style>
        #chat-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
        }
        #chat-history {
            height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #eee;
        }
        #message-input {
            width: 80%;
            padding: 8px;
        }
        button {
            padding: 8px 15px;
        }
        .agent-header {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        #agent-selector-container {
            margin-bottom: 20px;
        }
        .search-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .search-fields input,
        .search-fields select,
        .search-fields button {
            width: 100%;
            padding: 8px;
        }
        #agent-selector {
            width: 100%;
            padding: 8px;
        }
        #agent-info {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="agent-selector-container">
            <div class="search-fields">
                <input type="text" id="agent-search" placeholder="Search by name...">
                <input type="number" id="age-search" placeholder="Age">
                <select id="sex-search">
                    <option value="">Select Sex</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                <select id="race-search">
                    <option value="">Select Race</option>
                    <option value="White">White</option>
                    <option value="Black">Black</option>
                    <option value="Asian">Asian</option>
                    <option value="Hispanic">Hispanic</option>
                </select>
                <button onclick="searchAgents()">Search</button>
            </div>
            <select id="agent-selector" onchange="changeAgent()">
                <option value="">Select an agent...</option>
                <option value="01fd7d2a-0357-4c1b-9f3e-8eade2d537ae">Joon - PhD Student at Stanford</option>
                <option value="software_engineer">Software Engineer</option>
            </select>
        </div>
        
        <div id="agent-info"></div>
        <div id="chat-history"></div>
        <input type="text" id="message-input" placeholder="Type your message..." disabled>
        <button onclick="sendMessage()" id="send-button" disabled>Send</button>
    </div>
    
    <script>
        let chatHistory = [];
        let currentAgent = '';
        
        const agentDetails = {
            '01fd7d2a-0357-4c1b-9f3e-8eade2d537ae': {
                name: 'Joon',
                role: 'PhD Student at Stanford',
                description: 'A PhD student in Computer Science focusing on AI and human-computer interaction. Originally from Korea, now studying at Stanford University.'
            },
            'software_engineer': {
                name: 'Software Engineer',
                role: 'Professional Developer',
                description: 'An experienced software engineer working in tech industry.'
            }
        };
        
        async function searchAgents() {
            const name = document.getElementById('agent-search').value;
            const age = document.getElementById('age-search').value;
            const sex = document.getElementById('sex-search').value;
            const race = document.getElementById('race-search').value;
            
            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name, age, sex, race })
                });
                const agents = await response.json();
                updateAgentSelector(agents);
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        function updateAgentSelector(agents) {
            const selector = document.getElementById('agent-selector');
            selector.innerHTML = '<option value="">Select an agent...</option>';
            
            if (agents.length === 0) {
                const option = document.createElement('option');
                option.text = 'No agents found matching criteria';
                option.disabled = true;
                selector.appendChild(option);
                return;
            }
            
            agents.forEach(agent => {
                const option = document.createElement('option');
                option.value = agent.id;
                option.text = `${agent.first_name || ''} ${agent.last_name || ''} (${agent.age || 'N/A'}, ${agent.sex || 'N/A'})`;
                selector.appendChild(option);
            });
        }
        
        document.getElementById('agent-search').addEventListener('input', filterAgents);
        
        function changeAgent() {
            currentAgent = document.getElementById('agent-selector').value;
            const agentInfo = document.getElementById('agent-info');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            
            if (currentAgent) {
                agentInfo.style.display = 'none';
                messageInput.disabled = false;
                sendButton.disabled = false;
            } else {
                agentInfo.style.display = 'none';
                messageInput.disabled = true;
                sendButton.disabled = true;
            }
            
            chatHistory = [];
            document.getElementById('chat-history').innerHTML = '';
        }
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value;
            if (!message) return;
            
            displayMessage('User', message);
            input.value = '';
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message, 
                        history: chatHistory,
                        agent_id: currentAgent
                    })
                });
                const data = await response.json();
                displayMessage('Agent', data);
                chatHistory.push(['User', message], ['Agent', data]);
            } catch (error) {
                console.error('Error:', error);
                displayMessage('Agent', {error: error.message});
            }
        }
        
        function displayMessage(sender, message) {
            const chatHistory = document.getElementById('chat-history');
            let messageHtml = `<p><strong>${sender}:</strong> `;
            
            if (typeof message === 'object') {
                if (message.error) {
                    messageHtml += `<span style="color: red;">${message.error}</span>`;
                } else if (message.response) {
                    messageHtml += message.response;
                }
            } else {
                messageHtml += message;
            }
            
            messageHtml += '</p>';
            chatHistory.innerHTML += messageHtml;
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
